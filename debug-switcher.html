<!DOCTYPE html>
<html>
<head>
    <title>Debug Dashboard Switcher</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .debug-panel { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        .sidebar-demo { width: 250px; background: #1e293b; color: white; padding: 20px; float: left; }
        .property-selector { padding: 15px; background: rgba(255,255,255,0.05); margin-bottom: 15px; }
        #debug-output { background: #f0f0f0; padding: 15px; font-family: monospace; font-size: 12px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ðŸ”§ Dashboard Switcher Debug</h1>
    
    <div class="debug-panel">
        <h2>Status</h2>
        <div id="debug-output"></div>
    </div>

    <div class="sidebar-demo">
        <div class="property-selector">
            <div>Current Property</div>
            <div style="font-weight: bold;">Travel Link Hotel</div>
        </div>
        
        <div id="dashboard-switcher-container" style="background: rgba(255,0,0,0.1); min-height: 20px;"></div>
    </div>

    <script src="shared/auth.js"></script>
    <script src="shared/upgrade-modal.js"></script>
    <script src="shared/dashboard-switcher.js"></script>
    
    <script>
        const output = document.getElementById('debug-output');
        
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = message;
            output.appendChild(div);
        }

        // Step 1: Create session
        log('Step 1: Creating test session...');
        const testSession = {
            username: 'admin',
            fullName: 'Administrator',
            role: 'Full Access',
            permissions: ['travel-link', 'vr-hotel'],
            loginTime: new Date().toISOString()
        };
        sessionStorage.setItem('auth_session', JSON.stringify(testSession));
        log('âœ“ Session created');

        // Step 2: Check Auth
        log('Step 2: Checking Auth...');
        if (typeof Auth === 'undefined') {
            log('âœ— Auth object not found!', true);
        } else {
            log('âœ“ Auth object found');
            
            if (Auth.isAuthenticated()) {
                log('âœ“ User is authenticated');
                const info = Auth.getUserInfo();
                log('âœ“ User info: ' + info.fullName);
            } else {
                log('âœ— User not authenticated', true);
            }
        }

        // Step 3: Check dashboard-switcher.js
        log('Step 3: Checking dashboard-switcher.js...');
        if (typeof initDashboardSwitcher === 'undefined') {
            log('âœ— initDashboardSwitcher function not found!', true);
        } else {
            log('âœ“ initDashboardSwitcher function found');
        }

        // Step 4: Check container
        log('Step 4: Checking container...');
        const container = document.getElementById('dashboard-switcher-container');
        if (container) {
            log('âœ“ Container found');
            log('  Container innerHTML length: ' + container.innerHTML.length);
        } else {
            log('âœ— Container not found!', true);
        }

        // Step 5: Initialize switcher
        log('Step 5: Initializing dashboard switcher...');
        setTimeout(() => {
            try {
                initDashboardSwitcher('travel-link');
                log('âœ“ initDashboardSwitcher called');
                
                setTimeout(() => {
                    const containerAfter = document.getElementById('dashboard-switcher-container');
                    if (containerAfter && containerAfter.innerHTML.length > 0) {
                        log('âœ“ SUCCESS! Switcher HTML injected');
                        log('  Content length: ' + containerAfter.innerHTML.length);
                    } else {
                        log('âœ— FAILED! Container still empty', true);
                    }
                }, 200);
            } catch (e) {
                log('âœ— Error: ' + e.message, true);
            }
        }, 500);
    </script>
</body>
</html>
